<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Castle generation – In Ruins - NULLPOINTER</title><meta name="description" content="This post outlines some of the technical issues and solutions connected with&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://tomnullpointer.github.io/gh-pages/castle-generation-in-ruins.html"><link rel="alternate" type="application/atom+xml" href="https://tomnullpointer.github.io/gh-pages/feed.xml" title="NULLPOINTER - RSS"><link rel="alternate" type="application/json" href="https://tomnullpointer.github.io/gh-pages/feed.json" title="NULLPOINTER - JSON"><meta property="og:title" content="Castle generation – In Ruins"><meta property="og:site_name" content="NULLPOINTER"><meta property="og:description" content="This post outlines some of the technical issues and solutions connected with&hellip;"><meta property="og:url" content="https://tomnullpointer.github.io/gh-pages/castle-generation-in-ruins.html"><meta property="og:type" content="article"><link rel="preload" href="https://tomnullpointer.github.io/gh-pages/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://tomnullpointer.github.io/gh-pages/assets/css/style.css?v=692a0b969a48f4df78a60f0739f2c5c3"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomnullpointer.github.io/gh-pages/castle-generation-in-ruins.html"},"headline":"Castle generation – In Ruins","datePublished":"2025-10-04T19:15+01:00","dateModified":"2025-10-04T19:22+01:00","description":"This post outlines some of the technical issues and solutions connected with&hellip;","author":{"@type":"Person","name":"me","url":"https://tomnullpointer.github.io/gh-pages/authors/me/"},"publisher":{"@type":"Organization","name":"me"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container"><div class="left-bar"><div class="left-bar__inner"><header class="header"><a class="logo" href="https://tomnullpointer.github.io/gh-pages/">NULLPOINTER</a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle__box"><span class="navbar__toggle__inner">Menu</span></span></button><ul class="navbar__menu"></ul></nav><a class="logo logo--atbottom" href="https://tomnullpointer.github.io/gh-pages/">NULLPOINTER</a></header></div></div><main class="main post"><article class="content"><div class="content__meta content__meta--attop"><div class="content__meta--attop__inner"><div class="content__maintag"><svg width="20" height="20" aria-hidden="true" focusable="false"><use xlink:href="https://tomnullpointer.github.io/gh-pages/assets/svg/svg-map.svg#tag"/></svg> Published in <a href="https://tomnullpointer.github.io/gh-pages/tags/explainer/" class="metadata__maintag">Explainer</a></div></div></div><div class="main__inner"><div class="content__meta"><div class="content__author"><div><a href="https://tomnullpointer.github.io/gh-pages/authors/me/" class="content__author__name">me</a></div></div><div class="content__date"><time datetime="2025-10-04T19:15">Oct 4, 2025</time></div></div><header class="content__header"><h1 class="content__title">Castle generation – In Ruins</h1></header><div class="content__entry"><div class="entry-header"><h1 class="entry-title"><img loading="lazy" style="color: #a5a7b7; font-family: sans-serif; font-size: inherit; font-weight: 400;" src="http://www.nullpointer.co.uk/images/ResHubInRuins1.jpg" alt="" width="100%/" data-is-external-image="true"></h1></div><div class="entry-container"><div class="entry-content"><article><p>This post outlines some of the technical issues and solutions connected with the development of In Ruins, the second game produced for my PhD research.</p><p>In Ruins is an ambient exploration game with simple platforming and power up mechanics. It’s based on a small island of ruined castle walls and crumbling towers. This environment is procedurally generated using an extension of some traditional rogue-like dungeon generation techniques. More generalised information about the game and a download of the software is <a href="https://tomnullpointer.itch.io/in-ruins">available at this link</a>. A description of the approach developed for In Ruins is outlined below.</p><h2>2D Dungeon-like world generation stage</h2><p>Although the world of In Ruins is 3D the architectural blueprint is based on a 2D floorplan generator. This generator can produce a range of layouts as illustrated below.</p><p><img loading="lazy" src="http://www.nullpointer.co.uk/images/ResHubInRuins2.jpg" alt="" width="100%/" data-is-external-image="true"></p><p>The generator is based on some of the ideas outlined in the <a href="http://donjon.bin.sh/d20/dungeon/">d20 Random Dungeon Generator</a> and operates in the following manner.</p><ul><li> A world definition dictates the number of desired ‘rooms’ and the range of dimensions (width/height) of those rooms. This definition also describes the overall dimension of the world, which is used to build a 2d array grid that is used for the placement and arrangement of rooms, corridors and doorways. The definition allows for ranges of variation in parameters such as room size, corridor length and floor height.</li><li>A function AddRooms() attempts to place the desired number of rooms into the total base grid. There are a few placement routines that allow symmetrical layouts, sparse layouts, linear and constrained layouts etc. Each routine checks the validity of any newly placed room against the location of all previously placed rooms (checking for the intersection of walls and floor areas). The placement functions also ensure that there is sufficient space between rooms to allow for corridors and to avoid walls overlapping to double thickness. This is achieved by trapping all the placement locations and room dimensions to EVEN co-ordinates and room dimensions to ODD sizes. This ensures that the connections between rooms will line up correctly. When placing rooms in the grid the algorithm marks individual cells in the interiors as room tiles and those on the perimeter as wall tiles. This helps when checking the validity of subsequent room placements and also helps when locating doorways. Whne a room is placed it is recorded in a list, storing its ID, its x,y location and its</li><li>A function AddExits() places a number of exits in the wall perimeter of a room, it uses the centre-point and dimensions recorded for a room to calculate the location of potential exits which are then checked against the grid to see if the cells are currently marked as walls. If the exit is valid then the cell is marked as a doorway in the master grid.</li><li>The system then executes the AddCorridors() function. This steps through the master grid and whenever it encounters a cell marked as a doorway it attempts to ‘grow’ a corridor. The corridors are made by placing corridor tiles in a series of spans, starting at the discovered exit. Each span is of 2 cells length, to ensure it remains on the correct odd/even spacing and will connect to other doors. The corridors are then recursively generated from the endpoint of the last span. There is a chance for corridors to change direction or split at the end of any span. The probability of this is controlled by a series of variables in the general world definition.</li></ul><p>The image below demonstrates these features as follows: empty grid cells are black, corridors are white, room outer walls are red, doorways are green and the interior of each room is assigned a random colour. Door cells also indicate their exit direction, n,s,e,w and interior room cells also store their unique id. This allows later functions to decorate or alter each room specifically. A webplayer of this prototype is available <a href="http://www.nullpointer.co.uk/unity/rogue/WebPlayer.html">here </a>to demonstrate the algorithms.</p><p><img loading="lazy" src="http://www.nullpointer.co.uk/images/rogue2d.jpg" alt="" width="100%/" data-is-external-image="true"></p><p>5. The system then extends this 2D floorplan by assigning floor heights to each room. The corridor cells also have height levels that are adjusted dependent on the room heights that they connect to. The corridor heights are modified in a recursive process that creates stairs between connected room of different heights. The plan is then used to generate a 3D ‘maze’. Rather than rooms being enclosed as they would be in a traditional rogue-like, each room is treated as a plateau. This leads to the construction of spaces like the one in the image below. </p><h2>3D Extension to the generation</h2><p><img loading="lazy" src="http://www.nullpointer.co.uk/images/rogue3d3.jpg" alt="" width="100%/" data-is-external-image="true"></p><p>The construction process of the 3D version was then extended with the placement of various prop items and the variation of block forms.</p><p><img loading="lazy" src="http://www.nullpointer.co.uk/images/ResHubInRuins4.jpg" alt="" width="100%/" data-is-external-image="true"></p><p>The range of styles possible is quite large, as indicated in the following images.</p><p><img loading="lazy" src="http://www.nullpointer.co.uk/images/ResHubInRuins3.jpg" alt="" width="100%/" data-is-external-image="true"></p><p>To ensure that the resulting 3D model is graphically efficient the code that constructs the world from the floorplan calculates the neighbours for each cell and selects a 3D block that connects appropriately to adjacent cells. The image below shows the 16 blocks designed for all the possible connections in a Von Neumann neighbourhood. A good explanation of how this technique works for traditional tile games can be found <a href="http://www.angryfishstudios.com/2011/04/adventures-in-bitmasking/">here</a>.</p><p><img loading="lazy" src="http://www.nullpointer.co.uk/images/ResHubInRuins5.jpg" alt="" width="100%/" data-is-external-image="true"></p><p>The mesh construction could be done procedurally, but by using a Look-Up table of prefab forms the code can substitute alternatives to create a more varied and organic look. A selection of three cube forms and their variations is illustrated below. The cubes themselves are also textured procedurally, using a custom tri-planar mapping technique. This means that however tall the individual columns become the texturing on the will not stretch or deform. This shader technique will be covered in a future post.</p><p><img loading="lazy" src="http://www.nullpointer.co.uk/images/ResHubInRuins6.jpg" alt="" width="100%/" data-is-external-image="true"></p><p>The final stage of generation involves dropping pre-designed tree models and grass prefabs onto the geometry. This is done by selecting a room from the list of those placed and then positioning the items within the rooms dimension and at the height the room is set to. This process could also be used to place specific items in specific rooms or place objects adjacent to walls or doors.</p></article></div></div></div><footer class="content__footer"><div class="content__last-updated">This article was updated on <time datetime="2025-10-04T19:22">Oct 4, 2025</time></div><div class="content__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftomnullpointer.github.io%2Fgh-pages%2Fcastle-generation-in-ruins.html" class="js-share facebook tltp tltp--top" aria-label="Facebook" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://tomnullpointer.github.io/gh-pages/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Ftomnullpointer.github.io%2Fgh-pages%2Fcastle-generation-in-ruins.html&amp;via=NULLPOINTER&amp;text=Castle%20generation%20%E2%80%93%20In%20Ruins" class="js-share twitter tltp tltp--top" aria-label="Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://tomnullpointer.github.io/gh-pages/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Ftomnullpointer.github.io%2Fgh-pages%2Fcastle-generation-in-ruins.html&amp;media=undefined&amp;description=Castle%20generation%20%E2%80%93%20In%20Ruins" class="js-share pinterest tltp tltp--top" aria-label="Pinterest" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://tomnullpointer.github.io/gh-pages/assets/svg/svg-map.svg#pinterest"/></svg> <span>Pinterest</span></a></div></footer></div></article></main><div class="right-bar"><div class="right-bar__inner"><div class="sidebar"><section class="box featured"><h3 class="box__title">Featured Posts</h3><ul class="featured__container"><li class="featured__item"><div><a href="https://tomnullpointer.github.io/gh-pages/about-me-post.html" class="featured__title">About Me</a></div></li><li class="featured__item"><div><a href="https://tomnullpointer.github.io/gh-pages/about-my-academic-practice.html" class="featured__title">Academic Practice</a></div></li><li class="featured__item"><div><a href="https://tomnullpointer.github.io/gh-pages/cv-bio.html" class="featured__title">C.V. Bio</a></div></li><li class="featured__item"><div><a href="https://tomnullpointer.github.io/gh-pages/nullpointer-games.html" class="featured__title">Commercial Games</a></div></li><li class="featured__item"><div><a href="https://tomnullpointer.github.io/gh-pages/game-jams-and-freebies.html" class="featured__title">Game Jams and Freebies</a></div></li></ul></section><section class="box tags"><h3 class="box__title">Recommended Topics</h3><ul class="tags__list"><li class="tags__item"><a href="https://tomnullpointer.github.io/gh-pages/tags/about/" class="btn btn--gray">About <sup>(4)</sup></a></li><li class="tags__item"><a href="https://tomnullpointer.github.io/gh-pages/tags/devblog/" class="btn btn--gray">DevBlog <sup>(3)</sup></a></li><li class="tags__item"><a href="https://tomnullpointer.github.io/gh-pages/tags/explainer/" class="btn btn--gray">Explainer <sup>(3)</sup></a></li><li class="tags__item"><a href="https://tomnullpointer.github.io/gh-pages/tags/game-development/" class="btn btn--gray">Game Development <sup>(4)</sup></a></li><li class="tags__item"><a href="https://tomnullpointer.github.io/gh-pages/tags/installation-art/" class="btn btn--gray">Installation Art <sup>(1)</sup></a></li><li class="tags__item"><a href="https://tomnullpointer.github.io/gh-pages/tags/procedural-generation/" class="btn btn--gray">Procedural Generation <sup>(5)</sup></a></li></ul></section></div></div></div></div><script defer="defer" src="https://tomnullpointer.github.io/gh-pages/assets/js/scripts.min.js?v=b2d91bcadbf5db401b76eb5bb3092eb7"></script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>